# 常见的垃圾回收器介绍

在jdk1.6中，常见的几种垃圾回收器如下图所示


## Serial串行回收器

Serial串行回收器是所有垃圾回收器中最古老的一种，也是JDK中最基本的垃圾回收器之一。

在串行回收器进行垃圾回收时，Java应用程序中的线程都需要暂停工作，等待垃圾回收完成。如图所示，在串行回收器运行时，应用程序中的所有线程都停止工作，进行等待，这种现象称为“Stop-The-World”。它将造成非常糟糕的用户体验，在实时性要求较高的应用场景中，这往往是不能接受的。

虽然如此，串行回收器却是一种却是一种成熟且经过长时间生产环境考验的极为高效的收集器。新生代串行回收器使用复制算法，实现相对简单、逻辑处理特别高效且没有线程切换的开销。在诸如单CPU处理器等硬件平台不是特别优越的情况下，它的性能表现可以超过并行回收器和并发回收器。

使用-XX:+UseSerialGC参数可以指定使用新生代串行回收器和老年代串行回收器。

注意：串行回收器虽然古老，但是久经考验，在大多数情况下，其性能表现是相当不错的。

## 老年代串行回收器

**老年代串行回收器使用的是标记压缩法**。和新生代一样，它也是一个独占式的垃圾回收器。由于老年代垃圾回收器通常会需要比新生代垃圾回收更长的时间，在堆空间较大的应用程序中，一旦老年代串行回收器启动，应用程序很可能会因此停顿较长的时间。

虽然如此，作为老牌的垃圾回收器，老年代串行回收器可以和很多中新生代垃圾回收器配合使用，同时它也可以作为CMS回收器的备用回收器。

若要启用老年代串行回收器，可以尝试使用以下参数。

* -XX:+UseSerialGC：新生代、老年代都使用串行回收器。
* -XX:+UseParNewGC（JDK9、JDK10已经删除，因为ParNew需要和CMS搭配工作，而CMS已经被G1替代，不再支持此参数）：新生代使用ParNew回收器，老年代使用串行回收器。
* -XX:+UseParallelGC：新生代使用ParallelGC回收器，老年代使用串行回收器。

## 新生代ParNew回收器

**ParNew回收器是一个工作在新生代的垃圾回收器。它只是简单地将串行垃圾回收器多线程化，它的回收策略、算法及参数和新生代串行回收器一样（多线程复制算法）**。ParNew回收器的工作示意图如图所示。ParNew回收器也是独占式的回收器，在回收过程中应用程序会全部暂停。但由于并行回收器使用多线程进行垃圾回收，在并发能比较弱的CPU上，它产生的停顿时间要短于串行回收器，而在单CPU或者并发能力较弱的系统中，并行回收器的效果不会比串行回收器好；由于多线程的压力，它的实际表现可能比串行回收器差。




开启ParNew回收器可以使用以下参数。

* +XX:+UseParNewGC（JDK9、JDK10已经删除，因为ParNew需要和CMS搭配工作，而CMS已经被G1替代，不再支持此参数）：新生代使用ParNew回收器，老年代使用串行回收器。
* +XX:+UseConcMarkSweepGC（JDK9、JDK10不建议使用，建议使用默认的G1垃圾回收器）：新生代使用ParNew回收器，老年代使用CMS

ParNew回收器工作时的线程数量可以使用-XX:ParallelGCThreads参数指定。一般，最好与CPU数量相当，避免过多的线程数量影响垃圾回收性能。在默认情况下，当CPU数量小于8时，ParallelGCThreads的值等于CPU数量，当CPU数量大于8时，ParallelGCThreads的值等于3+((5XCPU_Count)/8)。


## 新生代ParallelGC回收器

**新生代ParallelGC回收器也是使用复制算法的回收器**。从表面上看，它和ParNew回收器一样，都是多线程，独占式的回收器。但是，ParallelGC回收器有一个重要的特点：它非常关注系统的吞吐量。

新生代ParallelGC回收器可以使用以下参数启用。

* -XX:+UseParallelGC：新生代使用ParallelGC回收器，老年代使用串行回收器。
* -XX:+UseParallelOldGC：新生代使用ParallelGC回收器，老年代使用ParallelOldGC回收器。

ParallelGC回收器提供了两个重要的参数用于控制系统的吞吐量。

* -XX:MaxGCPauseMillis：设置最大垃圾回收停顿时间。它的值是一个大于0的整数。ParallelGC在工作时，会调整



## 老年代ParallelOldGC回收器

老年代ParallelOldGC回收器也是一种多线程并发的回收器。和新生代ParallelGC回收一样，它也是一种关注吞吐两的回收器。从名字上看，它在ParallelGC中间插入了Old，表示这是一个应用于老年代的回收器，并且和ParallelGC新生代回收器搭配使用。

ParallelOldGC回收器使用标记压缩法，他在JDK1.6中才可以使用。下图为老年代ParalleOldGC回收器工作示意图。



使用-XX:+UseParallelOldGC可以在新生代使用ParallelGC回收器，老年代使用ParallelOldGC回收器。这是一对非常关注吞吐linage的垃圾回收器。在对吞吐量敏感的系统中，可以考虑使用。参数-XX:ParallelGCThreads也可以用于设置垃圾回收时的线程数量。



## CMS回收器

略



## G1回收器

略
