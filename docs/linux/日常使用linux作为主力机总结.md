# 日常使用linux作为主力机总结

## linux内核处理

使用linux作为日常主机会发现linux的内核更新非常频繁，经常一周就能收到好几次更新信息。所以选择一个稳定的linux内核版本和确定是否更新内核是一个很重要的事情。

### 选择一个适合的内核版本

选择内核版本要从自己的实际需求出发，并不是版本越新越好，而是越符合需求越好。主要有以下几个方面需要考虑：

1、硬件驱动是否兼容

linux内核不同版本之间对于硬件驱动的支持可能很不一样，例如，对于华硕TUF GAMING b550 wifi plus这个主板，存在一个wifi模块，这个模块是联发科生产的，其驱动在内核版本
5.10.x中并没有支持，而在6.1.x中支持了。所以在选择内核版本时，需要充分考虑到自己电脑的硬件设备兼容性。

通常选择linux内核版本之前，需要自行查看自己的硬件设备的驱动版本，然后看linux的内核发布日志中是否存在相应的驱动支持信息。

2、内核版本是否是长期支持版本或稳定版本

linux内核网站：[https://www.kernel.org/](https://www.kernel.org/)

通常在linux的内核网站上可以看到目前主要维护的linux版本，稳定版未stable，长期支持版本为longterm，主要开发版本为mainline。通常建议选择稳定版本。如果不建议折腾的话，
可以选择一个比较新的长期支持版本或者主要开发版本。

3、软件是否兼容

选择内核版本也要考虑到自己日常使用的软件是否对于内核版本有要求。例如：如果日常使用docker，那么需要关注一下docker版本与内核版本之间的兼容性。
一些涉及到底层的应用也会对内核版本有一定的要求。


### 自己编译内核并安装

选择符合自己需求的内核版本之后，可以从内核网站下下载压缩包，在本地自己使用gcc进行编译安装。具体的步骤如下：

1、查看自己正在使用的内核版本

```bash
uname -r
```

2、下载合适的内核版本并解压

3、编译linux的内核配置（以debian11为例）

编译linux内核版本需要进行一系列配置，例如是否编译某些驱动程序到内核中，是否加载某些模块到内核中。这个配置非常复杂，完整的配置可能有几万个配置项。
一般情况下选择默认的配置即可，如果是在一些IOT设备或项目中，对于内核有需要精简的需求，那么需要额外找资料了解这些配置的意义。这里就不做展开讨论了。

```bash
# 进入到解压后的内核文件夹中
sudo make menuconfig
```
编译过程中可能会提示缺少某些库，缺少哪些库就使用apt命令进行安装即可。

编译完成后会弹出命令行式的图形界面，例如：

![](http://www.lingjiatong.cn:30090/rootelement/articleQuote/Snipaste_2023-04-06_15-11-34.png
)

一般情况下直接选择save保存即可。如果存在之前所说的精简内核的需求，可以查看相应的文档介绍移除不需要的内核模块或编译项。

内核配置编译完成之后，会在内核源码根目录中生成一个.config文件，这个文件就是当前内核的整个的配置文件。

4、编译内核

```bash
# 内核配置编译完成之后，就可以对内核进行编译了
sudo make -j 24
```

5、编译内核模块

```bash
# 编译完内核之后，还需要编译内核模块
sudo make modules_install
```

6、安装内核到系统

```bash
# 内核编译完成之后，就可以进行按安装了
sudo make install
```

安装内核会自动配置grub引导。

### 删除多余的内核版本和禁止内核自动更新

由于内核更新很频繁，刚使用linux的小白可能经常就稀里糊涂安装了很多内核，可以通过如下步骤删除没有用的内核版本：

1、查看当前内核版本

```bash
uname -r
```

2、查看已经安装的内核

```bash

```

3、卸载无用内核

```bash

```

4、更新grub引导

```bash

```


## 配置相关

### 设置取消功能键

向 /sys/module/hid_apple/parameters/fnmode 文件中写入不同的值，可切换不同的模式：

```bash
echo 2 > /sys/module/hid_apple/parameters/fnmode
```

* 0  禁用功能键，按 ‘Fn’ + ‘F8’ 等同于 F8
* 1  默认功能键，按 ‘F8’ 触发功能键 (play/pause)，按 ‘Fn’ + ‘F8’ 触发 F8 键
* 2  默认非功能键，按 ‘F8’ 触发 F8 键，按 ‘Fn’ + ‘F8’ 触发功能键 (play/pause)

以上方法重启后失效，如果要让配置永久生效：

```bash
# vi /etc/modprobe.d/hid_apple.conf
options hid_apple fnmode=2

# 在您触发将配置复制到 initramfs 引导文件之前，这不会执行任何操作。这可以通过终止 update-initramfs 服务来完成。
sudo update-initramfs -u -k all
```

